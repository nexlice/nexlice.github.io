---
title: MongoDB
tags: 
 - NoSQL
 - Document based Database
 - Import and Export

description: Learn about the basic jargons of database!
---

> 본 글은 Codestates BEB 코스의 자료에서 내용을 가져와 작성하였음을 알립니다.  

{% include alert.html type="danger" title="Warning!" content="이 문서는 아직 미완성 문서입니다." %}

# MongoDB
`MongoDB`는 대표적인 `NoSQL` 도큐먼트 데이터베이스이다.
도큐먼트 데이터베이스는 데이터를 테이블이 아닌, 문서처럼 저장하는 데이터베이스를 의미한다.  
일반적으로 도큐먼트 데이터베이스에서는 `JSON` 유사 형식으로 데이터를 문서화한다.  
각각의 도큐먼트는 데이터를 `필드-값`의 형태를 가지고 있고, 컬렉션이라고 하는 그룹으로 묶어서 관리한다.  

### NoSQL Database
`MongoDB`는 `NoSQL` 도큐먼트 데이터베이스이다.  
`NoSQL`은 매우 넓은 범위에서 사용하는 용어로,  
관계형 테이블의 레거시한 방법을 사용하지 않는 데이터 저장소를 말한다.  
<br>

### Use Cases
1. 비구조적인 대용량의 데이터를 저장하는 경우  

`NoSQL` 데이터베이스는 관계에 중점을 둔 `SQL`데이터베이스보다 자유로운 형태로 데이터를 저장할 수 있으므로,  
필요에 따라서 새로운 데이터 유형을 추가할 수 있따.  
소프트웨어 개발에 정형화되지 않은 많은 양의 데이터가 필요한 경우, `NoSQL`이 효율적일 수 있다.  

2. 클라우트 컴퓨팅 및 저장공간을 최대한 활용하는 경우  

`NoSQL` 데이터베이스는 데이터베이스를 클라우드 기반으로 쉽게 분리할 수 있또록 지원하여, 저장 공간을 효율적으로 사용한다.  
시스템이 커지면서 DB를 증설해야하는 시점이 오면, SQL 데이터베이스에서는 수직적 확장의 형태로 DB를 증설한다.  
수직적으로 확장된 데이터베이스는 관리가 어려워질 수 있는 데에 반해,  
`NoSQL`은 순평적 확장의 형태로 증설하므로, 이론상 무한대로 서버를 계속 분산시켜 DB를 증설할 수 있다.  

3. 빠르게 서비스를 구축하고 데이터 구조를 자주 업데이트하는 경우  

`NoSQL` 데이터베이스의 경우 스키마를 미리 준비할 필요가 없어서, 개발을 빠르게 해야하는 경우에 매우 적합하다.  
시장에 빠르게 프로토타입을 출시해야하는 경우, 소프트웨어 버전별로 다운타임 없이 데이터 구조를 자주 업데이트 해야하는 경우,  
일일이 스키마를 수정해주어야하는 관계형 데이터베이스보다 `NoSQL` 기반의 비관계형 데이터베이스가 더 효율적이다.  
> 다운타임이란, 데이터베이스의 서버를 오프라인으로 전환하여 작업하는 시간을 의미한다.  

### Atlas Cloud
`MongoDB`에서는 아틀라스로 클라우드에 데이터베이스를 설정한다.  
아틀라스는 GUI와 CLI로 데이터를 시각화, 분석, 내보내기, 그리고 빌드하는 데에 사용할 수 있다.  
아틀라스 사용자는 클러스터를 배포할 수 있으며, 클러스터는 그룹화된 서버에 데이터를 저장한다.  
> 클러스터란 데이터를 저장하는 서버 그룹으로,  
> 여러 대의 컴퓨터를 네트워크로 연결하여 하나의 단일 컴퓨터처럼 동작하도록 제장한 컴퓨터를 뜻한다.  
![클러스터 배포]()  

이 서버는 레플리카 세트(Replica set)로 구성되어 있으며, 레플리카 세트는 동일한 데이터를 저장하는 몇 개의 연결된 MongoDB 인스턴스의 모음이다.  
> 인스턴스는 특정 소프트웨어를 실해앟는 로컬 또는 클라우드의 단일 머신이다.  
> 이 경우 인스턴스는 클라우드에서 실행되는 MongoDB 데이터베이스이다.  

![레플리카 세트]()  

도큐먼트나 컬렉션을 변경할 경우, 변경된 데이터의 중복 사본이 레플리카 세트에 저장된다.  
이 설정 덕분에 레플리카 세트의 인스턴스 중 하나에 문제가 발생하더라도 데이터는 그대로 유지되며,  
레플리카 세트의 애플리케이션에서 나머지 작업을 할 수 있다.  
이 과정을 위해 클러스터(서버 그룹)을 배포하면, 자동으로 레플리카 세트가 구성된다.  

### MongoDB Document
MongoDB에서 도큐먼트가 무엇인지, 도큐먼트로 데이터를 어떻게 체계적인 방법으로 저장하는지 살펴보자.  
도큐먼트는 객체와 값이 데이터를 `필드-값`쌍 (Field-Value pair)로 저장하고 구성한다.  
도큐먼트에서 필드는 데이터의 고유한 식별자이고, 주어진 식별자와 관련된 데이터를 뜻한다.  

#### Jargons
- Document : 필드-값 쌍으로 저장된 데이터  
- Field : 데이터 포인트를 위한 고유한 식별자  
- Value : 주어진 식별자와 연결된 데이터  
- Collection : MongoDB의 도큐먼트로 구성된 저장소. 일반적으로 도큐먼트 간 공통 필드가 있다.  
데이터베이스 당 많은 컬렉션이 있고, 컬렉션 당 많은 도큐먼트가 있을 수 있다.  

### JSON vs BSON
shell을 이용하여 도큐먼트를 조회하거나 업데이트할 때, 도큐먼트는 JSON 형식으로 출력된다.  
JSON 형식으로 도큐먼트를 작서앟기 위해서는, 다음과 같은 조건을 만족해야 한다.  
- `{}` 중괄호로 도큐먼트가 시작하고, 끝나야한다.  
- 필드와 값이 콜론(`:`)으로 분리되어야 하며, 필드와 값을 포함하는 쌍은 쉼표(`,`)로 구분된다.  
- 문자열인 필드도 쌍따옴표(`""`)로 감싸야 한다.  

```json
{
    "_id" : "408339803",
    "date" : ISODate("2019-02-04T05:00:00Z"),
    "listing_id" : "1038163",
    "reviewer_id" : "3600539",
    "reviewer_name" : "Ibrahim",
    "comments" : "Tolles Apartment. Ca. 200m zur îstiklal caddesi."
}
```

위에 제시한 조건 중 어느 하나라도 충족되지 않는다면, 유효한 도큐먼트가 아니다.  
JSON 형식은 읽기 쉽고, 많은 개발자가 사용하기 편리한 형태를 갖고 있다.  
그러나, JSON의 형태로 데이터를 저장할 때 단점도 존재한다.  
<br>  

JSON은 텍스 형식이기 때문에 읽기 쉽지만, 파싱이 느리고 메모리 사용이 비효율적이다.  
그리고 JSON은 기본 데이터 타입만을 지원하기 때문에, 사용할 수 있는 데이터 타입에 제약이 있다.  
<br>  

이런 문제점을 해결하기 위한 방안으로 `BSON`(Binary JSON) 형식을 도입하였다.  
다음은 BSON의 예시이다.
![BSON 예시]()  

`BSON`은 컴퓨터의 언어에 가까운 이진법에 기반을 둔 표현법이다.  
따라서 JSON보다 메모리 사용이 효율적이며 빠르고, 가볍고, 유연하다.  
또한 BSON의 사용으로 더 많은 데이터 타입을 사용할 수 있다.  

<br>  

MongoDB는 JSON형식으로 작성된 것은 무엇이든 데이터베이스에 추가할 수 있고, 쉽게 조회할 수 있다.  
그러나 그 내부에서는 속도, 효율성, 유연성의 장점이 있는 `BSON`으로 데이터를 저장, 사용하고 있다.  

#### Importing and Exporting
데이터를 어떤 로컬 장치나 다른 시스템으로 내보내거나, 가져올 때,  
데이터 형식(JSON, BSON)에 따라 달라지는 import, export 명령어에 대해서 알아보자.  
<br>  

`import`, `export`할 때에 경우데 따른 효율적인 데이터 형식이 존재한다.  
MongoDB는 BSON 형태로 저장이 되고 JSON 형태로 출력된다.  
단순 백업 저장을 하기 위해서라면 가볍고 빠른 BSON의 형태를 사용하는 편이 좋다.  
그러나 데이터를 내보낸 후 조회를 하거나 출력을 해야 한다면, 사람이 읽기 쉬운 JSON 형식이 바람직하다.  
그래서 조건에 따라, 가져오거나 내보낼 때 사용 가능한 명령어가 각각 존재한다.  

- JSON
    * `mongoimport` : 임의의 데이터 형식의 데이터를 아틀라스 클러스터로 `import`
    * `mongoexport` : 내보낼 컬렉션과 파일의 이름을 명시하여 로컬 머신에 JSON 형식의 파일을 `export`
- BSON
    * `mongorestore` : BSON 형식의 데이터를 `import`
    * `mongodump` : 아틀라스 클러스터 안에 있는 데이터베이스를 로컬 머신에 BSON 데이터로 `export`

```bash
mongorestore --uri "<Atlas Cluster URI>" [--drop dump]

Import data in BSON dump

mongoimport --uri "<Atlas Cluster URI>" [--drop=<filename>.json]

Import data in JSON
```