# Cookie
쿠키는 서버에서 클라이언트에 데이터를 저장하고 불러올 수 있는 방법의 하나이다.  
즉, 서버가 일방적으로 클라이언트에 전달하는 작은 데이터이다.  
그러므로 서버가 원한다면, 서버는 클라이언트에서 쿠키를 이용하여 데이터를 가져올 수 있다.  
<br>  

쿠키를 이용하는 것은 단순히 서버에서 클라이언트에 쿠키를 전송하는 것만 의미하지 않고,  
**클라이언트에서 서버로 쿠키를 전송하는 것도 포함된다.**  
사용자 선호, 테마, stay logged on 기능과 같은, 장시간 보존해야하는 정보 저장에 적합하다.  

## Cookie Options
쿠키는 서버가 클라이언트에 데이터를 저장하도록 한다.  
하지만 데이터를 저장한 이후, **아무 때나 데이터를 가져올 수 없다.**  
데이터를 저장한 이후, 특정 조건들이 만족하는 경우에만 다시 가져올 수 있따.  
이런 조건들은 **쿠키 옵션**으로 표현할 수 있다.  

### Domain
도메인이란 서버에 접속할 수 있는 이름이다.  
쿠키 옵션에서 도메인은 포트 및 서브 도메인 정보, 세부 경로를 포함하지 안흔다.  
여기서 서브 도메인이란, `www`와 같은 도메인 앞에 추가로 작성되는 부분을 말한다.  
<br>  

이를테면, 요청해야할 URL이 `http://www.localhost.com:3000/users/login`이라면,  
도메인은 `localhost.com`이 된다.  
만약 쿠키 옵션에서 도메인 정보가 존재한다면,  
클라이언트에서는 쿠키의 도메인 옵션과 서버의 도메인이 일치해야만 쿠키를 전송할 수 있다.  

### Path
세부 경로는 서버가 라우팅할 떄 사용하는 경로이다.  
요청해야하는 URL이 `http://www.localhost.com:3000/users/login`일 때,  
여기에서 Path, 세부 경로는 `/users/login`이 된다.  
명시하지 않았을 떄 기본으로 `/`로 설정되어 있다.  
<br>  

Path 옵션의 특징은 설정된 path를 전부 만족하는 경우,  
요청하는 Path가 추가로 더 존재하더라도, 쿠키를 서버에 전송할 수 있다.  
즉, Path가 `/users`로 설정되어 있고, 요청하는 세부 경로가 `/users/login`인 경우라면, 쿠키 전송이 가능하다.  

### MaxAge or Expires
쿠키가 유효한 기간을 정하는 옵션이다.  

- MaxAge : 앞으로 몇 초 동안 쿠키가 유효한지 설정  
- Expires : 클라이언트 시간 기준, 언제까지 유효한지 `Date`를 지정  

지정된 시간, 날짜를 초과하게 되면 쿠키는 자동으로 파괴된다.  
두 옵션이 모두 지정되지 않은 경우에는, 브라우저의 탭을 닫아야만 쿠키가 제거된다.  

### Secrue
쿠키를 전송해야 할 때 사용하는 프로토콜에 따른 쿠키 전송 여부를 결정한다.  
만약 해당 옵션이 `true`로 설정된 경우, `HTTPS` 프로토콜을 이용하여 통신하는 경우에만 쿠키를 전송할 수 있다.  

### HttpOnly
자바스크립트에서 브라우저의 쿠키에 접근 여부를 결정한다.  
만약 해당 옵션이 `true`로 설정된 경우, 자바스크립트에서는 쿠키에 접근이 불가능하다.  
명시되지 않은 경우 기본으로 `false`로 지정되어 있다.  
이 경우, 자바스크립트에서 쿠키에 `<script>` 태그로 접근이 가능하므로 `XSS` 공격에 취약하다.  
> XSS 공격이란, 악의적인 코드를 삽입..

### SameSite
Cross-Origin 요청을 받은 경우, 요청에서 사용한 메서드와 해당 옵션의 좋바으로 서버의 쿠키 전송 여부를 결정한다.  
`CSRF` 공격을 막을 수 있음.
사이트 에이가 사이트 비에서 사용자가 인증되는 동안 강제적으로 사이트 비에게 원하지 않는 요청을 하는 경우를 말한다.  
![samesite]()  

사용할 수 있는 옵션은 다음과 같다.  

- Lax : Cross-Origin 요청이면 `GET` 메서드에 대해서만 쿠키를 전송할 수 있다.  
- Strict : Cross-Origin이 아닌 `same-site`인 경우에만 쿠키를 전송할 수 있다.  
- None : 항상 쿠키를 보내줄 수 있다. 다만, 쿠키 옵션 중 `Secure` 옵션이 필요하다.  

> `same-site`란, 요청을 보낸 Origin과 서버의 도메인이 같은 경우를 말한다.  

---  

이러한 옵션들을 지정한 다음, 서버에서 쿠키를 전송해야한다면,  
클라이언트는 헤더에 `Cookie`라는 프로퍼티에 쿠키를 담에 서버에 쿠키를 전송한다.  

## Stateless to Stateful
이러한 쿠키의 특성을 이용하여 서버는 클라이언트에 인증정보를 담은 쿠키를 전송하고,  
클라이언트는 전달받은 쿠키를 요청과 같이 전송하여 Stateless한 인터넷 연결을 Stateful하게 유지할 수 있다.  

> HTTP는 stateless한 특성을 갖고 있어 다른 페이지들을 돌아다녀도 기록이 남지 않는게 정상이다.  

<br>  

하지만 기본적으로 쿠키는 오랜 시간 동안 유지될 수 있고,  
자바 스크립트를 이용해서 쿠키에 접근할 수 있기 때문에, 쿠키에 민감한 정보를 담는 것은 위험하다.  
<br>  

이런 인증정보를 탈취하여 서버에 요렁을 보낸다면,  
서버는 누가 요청을 보낸 건지 상관하지 않고, 인증된 유저의 요청으로 취급하기 때문에,  
개인 정보와 같은 민감한 정보에 접근이 가능하다.  

## Reference
[MDN : Set-Cookie Attributes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie)

? 이름이 왜 쿠키 ?